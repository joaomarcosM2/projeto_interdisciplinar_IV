<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Mobile - Espaçamento Perfeito</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --fixed-menu-offset: 0px; /* Será preenchido via JS */
            --initial-gap: 30px;      /* Espaço extra fixo para respiro */
            
            --page-padding-x: 16px;
            --strip-height: 14px;
            --button-height: 50px;
            --border-radius-outer: 12px; 
            --border-radius-inner: 10px; 
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            min-height: 200vh;
            margin: 0;
        }

        #page-header {
            height: 120px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            padding: 0 var(--page-padding-x); 
            border-bottom: 1px solid #ddd;
        }
        
        /* ONDE A MÁGICA ACONTECE */
        #main-content {
            padding: 1rem var(--page-padding-x); 
            
            /* O padding-top é a soma de:
               1. Espaço padrão (1rem)
               2. O Gap extra de respiro (--initial-gap)
               3. A altura do menu quando ele fica fixo (--fixed-menu-offset)
            */
            padding-top: calc(1rem + var(--initial-gap) + var(--fixed-menu-offset)); 
            
            /* Transição suave para não "pular" quando o padding muda */
            transition: padding-top 0.1s ease-out;
        }
        
        section { padding: 1rem; }

        /* ---------------------------------------------------- */
        /* Estilos do Menu Mobile */
        /* ---------------------------------------------------- */
        
        .related-content-section {
            background-color: transparent; 
            width: 100%;
            height: auto; 
            z-index: 50;
            display: flex;
            justify-content: center;
            padding: 10px var(--page-padding-x); 
            box-sizing: border-box;
            transition: padding 0.3s ease;
        }

        /* Menu Fixo */
        .related-content-section.fixed-on-top-small-screens {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%; 
            padding-top: 10px;
            pointer-events: none; 
            
            /* Fundo Blur */
            background-color: rgba(247, 247, 247, 0.85); 
            backdrop-filter: blur(12px); 
            border-bottom: 1px solid rgba(0,0,0,0.05); 
        }
        
        .related-content-section.fixed-on-top-small-screens > * {
            pointer-events: auto;
        }

        /* Container Principal */
        #floating-component-container {
            width: 100%; 
            min-width: 100px;
            height: auto; 
            max-height: var(--button-height); 
            background-color: transparent; 
            border-radius: 0; 
            overflow: visible; 
            position: relative;
            display: flex;
            flex-wrap: nowrap; 
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.15));
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), filter 0.3s ease;
        }

        #floating-component-container.no-anim,
        #floating-component-container.no-anim * {
            transition: none !important;
            animation: none !important;
        }

        #floating-component-container.vertical-expanded {
            max-height: 800px; 
        }

        /* ---------------------------------------------------- */
        /* BOTÕES */
        /* ---------------------------------------------------- */

        #menuToggle {
            position: absolute; left: 0; top: 0;
            height: var(--button-height); width: var(--button-height); 
            background-color: #fff;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 30; 
            border-radius: var(--border-radius-outer) var(--border-radius-inner) var(--border-radius-inner) var(--border-radius-outer);
            transition: border-radius 0.3s;
            border-right: 1px solid #e5e7eb; 
        }
        .expanded #menuToggle { border-radius: var(--border-radius-outer) 0 0 var(--border-radius-outer); }
        .vertical-expanded #menuToggle { border-radius: var(--border-radius-outer) 0 0 var(--border-radius-outer) !important; border-bottom: 1px solid #f3f4f6; }

        #toggle-section-btn {
            position: absolute; right: 0; top: 0;
            height: var(--button-height); width: var(--button-height); 
            background-color: #fff;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 30; 
            transition: border-radius 0.3s ease, background-color 0.3s;
            border-radius: var(--border-radius-inner) var(--border-radius-outer) var(--border-radius-outer) var(--border-radius-inner);
        }
        .expanded #toggle-section-btn { transform: translateY(100%); border-radius: 0 0 var(--border-radius-outer) var(--border-radius-outer); background-color: #f9fafb; }
        .vertical-expanded #toggle-section-btn { transform: translateY(0) !important; border-radius: 0 var(--border-radius-outer) 0 0 !important; background-color: #fff; border-bottom: 1px solid #f3f4f6; }

        .retracted::before {
            content: ''; position: absolute; top: 0; left: 25px; right: 25px; 
            height: var(--strip-height); background-color: #ffffff;
            border-radius: 8px 8px 0 0; z-index: 25; 
        }

        #relatedItemsWrapperContainer {
            position: absolute; top: 0; left: var(--button-height); right: var(--button-height); 
            height: var(--button-height); background-color: #fff; z-index: 10; overflow: hidden; 
            transition: opacity 0.3s ease, right 0.3s ease, border-radius 0.3s ease, height 0.4s ease;
            opacity: 0; border-radius: 0; 
        }
        .expanded #relatedItemsWrapperContainer { opacity: 1; right: 0; border-radius: 0 var(--border-radius-outer) 0 0; }
        .vertical-expanded #relatedItemsWrapperContainer {
            height: auto; min-height: 100%; right: 0;
            border-radius: 0 var(--border-radius-outer) var(--border-radius-outer) var(--border-radius-outer);
            z-index: 20; padding-bottom: 10px; border-left: 1px solid #f3f4f6;
        }

        .expanded::before { opacity: 0; transform: translateY(-100%); transition: opacity 0.1s; }

        #relatedItemsWrapper {
            display: flex; flex-direction: row; align-items: center; overflow-x: scroll; 
            white-space: nowrap; flex-wrap: nowrap; padding: 0 8px; scrollbar-width: none;
            width: 100%; height: 100%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); transform: translateY(-100%); 
        }
        .expanded #relatedItemsWrapper { transform: translateY(0); }
        .vertical-expanded #relatedItemsWrapper {
            flex-wrap: wrap; overflow-x: hidden; white-space: normal;
            justify-content: center; align-items: stretch; padding-top: 60px; 
            height: auto; padding-left: 10px; padding-right: 10px; gap: 8px; 
        }
        #relatedItemsWrapper::-webkit-scrollbar { display: none; }

        .related-item {
            padding: 6px 14px; font-size: 0.85em; cursor: pointer; color: #4b5563; 
            border-radius: 8px; margin: 2px; transition: all 0.3s ease; font-weight: 500;
            border: 1px solid transparent; flex-shrink: 0; display: flex; align-items: center;
            justify-content: center; text-align: center;
        }
        .vertical-expanded .related-item {
            margin: 0; background-color: #f9fafb; border: 1px solid #f3f4f6;
            width: auto; flex-grow: 1; min-width: 100px; padding: 10px; 
        }
        .related-item:hover { background-color: #f3f4f6; }
        .related-item.active { background-color: #eff6ff; color: #1d4ed8; border-color: #bfdbfe; font-weight: 600; transform: scale(1.05); z-index: 2; }

        #expanded-title {
            position: absolute; top: 0; left: var(--button-height); right: var(--button-height);
            height: var(--button-height); display: flex; align-items: center; justify-content: center;
            font-size: 0.85rem; font-weight: 700; color: #374151; text-transform: uppercase;
            letter-spacing: 0.05em; pointer-events: none; opacity: 0;
            transform: translateY(-10px); transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 25; border-bottom: 1px solid #f3f4f6; 
        }
        .vertical-expanded #expanded-title { opacity: 1; transform: translateY(0); }

        .static-mode #toggle-section-btn { display: none !important; }
        .static-mode #relatedItemsWrapperContainer { right: 0 !important; border-radius: 0 var(--border-radius-outer) var(--border-radius-outer) 0 !important; }
        .static-mode #floating-component-container { border-radius: var(--border-radius-outer) !important; }
        .static-mode #menuToggle { border-radius: var(--border-radius-outer) 0 0 var(--border-radius-outer) !important; }

    </style>
</head>
<body class="p-0 m-0">

    <header id="page-header">
        <h1 class="text-xl font-extrabold text-gray-700">Espaço Corrigido</h1>
    </header>

    <aside id="menu-bar" class="related-content-section">
        <div class="max-w-5xl w-full relative">
            <div id="floating-component-container" class="retracted">
                <div id="menuToggle"><span class="text-gray-700 text-xl">☰</span></div>
                <div id="expanded-title">Conteúdos Relacionados</div>
                <div id="relatedItemsWrapperContainer">
                    <div id="relatedItemsWrapper">
                        <div class="related-item" data-section="intro">Início</div>
                        <div class="related-item" data-section="prod">Produtos</div>
                        <div class="related-item" data-section="serv">UX/UI</div>
                        <div class="related-item" data-section="cases">Gestão de Tráfego</div>
                        <div class="related-item" data-section="about">Sobre Nós</div>
                        <div class="related-item" data-section="contact">Contato</div>
                        <div class="related-item" data-section="extra1">Blog</div>
                        <div class="related-item" data-section="extra2">RH</div>
                        <div class="related-item" data-section="extra3">Dev</div>
                        <div class="related-item" data-section="extra4">Suporte</div>
                    </div>
                </div>
                <div id="toggle-section-btn">
                    <svg id="section-toggle-icon" class="h-5 w-5 text-gray-600 transform transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
            </div>
        </div>
    </aside>

    <main id="main-content">
        <div class="p-4 bg-green-50 border border-green-200 rounded-lg mb-8 text-sm text-green-800 shadow-sm">
            <strong>Correção de Layout:</strong> Observe que agora existe um espaçamento generoso entre o menu e este bloco de texto, mesmo quando você começa a rolar. O menu não "cobre" o conteúdo imediatamente.
        </div>

        <section id="intro" class="h-[80vh] bg-white rounded shadow mb-4 flex items-center justify-center font-bold text-gray-300 text-4xl">Início</section>
        <section id="prod" class="h-[80vh] bg-white rounded shadow mb-4 flex items-center justify-center font-bold text-gray-300 text-4xl">Produtos</section>
        <section id="serv" class="h-[80vh] bg-white rounded shadow mb-4 flex items-center justify-center font-bold text-gray-300 text-4xl">UX/UI</section>
        <section id="cases" class="h-[80vh] bg-white rounded shadow mb-4 flex items-center justify-center font-bold text-gray-300 text-4xl">Cases</section>
        <section id="about" class="h-[80vh] bg-white rounded shadow mb-4 flex items-center justify-center font-bold text-gray-300 text-4xl">Sobre</section>
        <section id="contact" class="h-[80vh] bg-white rounded shadow mb-4 flex items-center justify-center font-bold text-gray-300 text-4xl">Contato</section>
        <section id="extra1" class="h-[80vh] bg-gray-100 rounded shadow mb-4 flex items-center justify-center font-bold text-gray-400 text-4xl">Blog</section>
        <section id="extra2" class="h-[80vh] bg-gray-200 rounded shadow mb-4 flex items-center justify-center font-bold text-gray-500 text-4xl">RH</section>
        <section id="extra3" class="h-[80vh] bg-gray-200 rounded shadow mb-4 flex items-center justify-center font-bold text-gray-500 text-4xl">Dev</section>
        <section id="extra4" class="h-[80vh] bg-gray-200 rounded shadow mb-4 flex items-center justify-center font-bold text-gray-500 text-4xl">Suporte</section>
    </main>

    <script>
        const menuBar = document.getElementById('menu-bar');
        const floatingComponentContainer = document.getElementById('floating-component-container');
        const sectionToggleBtn = document.getElementById('toggle-section-btn');
        const menuToggleBtn = document.getElementById('menuToggle');
        const sectionToggleIcon = document.getElementById('section-toggle-icon');
        const relatedItems = document.querySelectorAll('.related-item');
        const relatedItemsWrapper = document.getElementById('relatedItemsWrapper');
        const mainContent = document.getElementById('main-content');
        const sections = document.querySelectorAll('section');

        let currentMenuState = 'retracted'; 
        const STORAGE_KEY = 'folderMenuCycleState';

        const saveState = () => localStorage.setItem(STORAGE_KEY, currentMenuState);
        
        const updateMenuVisuals = () => {
            floatingComponentContainer.classList.remove('retracted', 'expanded', 'vertical-expanded');
            
            if (currentMenuState === 'retracted') {
                floatingComponentContainer.classList.add('retracted');
                sectionToggleIcon.style.transform = 'rotate(0deg)'; 
                
            } else if (currentMenuState === 'horizontal') {
                floatingComponentContainer.classList.add('expanded');
                sectionToggleIcon.style.transform = 'rotate(0deg)'; 
                
            } else if (currentMenuState === 'vertical') {
                floatingComponentContainer.classList.add('expanded');
                floatingComponentContainer.classList.add('vertical-expanded');
                sectionToggleIcon.style.transform = 'rotate(180deg)';
            }
        };

        menuToggleBtn.addEventListener('click', () => { alert("Botão Hambúrguer livre!"); });

        sectionToggleBtn.addEventListener('click', () => {
            if (currentMenuState === 'retracted') {
                currentMenuState = 'horizontal'; saveState(); updateMenuVisuals();
            } else if (currentMenuState === 'horizontal') {
                currentMenuState = 'vertical'; saveState(); updateMenuVisuals();
            } else if (currentMenuState === 'vertical') {
                floatingComponentContainer.classList.add('no-anim');
                currentMenuState = 'retracted'; saveState(); updateMenuVisuals();
                setTimeout(() => { floatingComponentContainer.classList.remove('no-anim'); }, 50);
            }
        });

        const handleScrollBehavior = () => {
            const scrollY = window.scrollY;
            
            if (scrollY > 80) {
                // Fixo
                menuBar.classList.add('fixed-on-top-small-screens');
                floatingComponentContainer.classList.remove('static-mode'); 
                
                // CRUCIAL: Adiciona a altura do menu AO padding existente
                // O padding já tem o 'gap' embutido no CSS, então somamos só a altura da barra
                mainContent.style.setProperty('--fixed-menu-offset', menuBar.offsetHeight + 'px');
                
                updateMenuVisuals();
            } else {
                // Topo
                floatingComponentContainer.classList.add('no-anim');
                menuBar.classList.remove('fixed-on-top-small-screens');
                floatingComponentContainer.classList.add('static-mode'); 
                mainContent.style.setProperty('--fixed-menu-offset', '0px');
                
                currentMenuState = 'horizontal'; 
                floatingComponentContainer.classList.remove('retracted', 'vertical-expanded');
                floatingComponentContainer.classList.add('expanded');
                sectionToggleIcon.style.transform = 'rotate(0deg)'; 
                setTimeout(() => { floatingComponentContainer.classList.remove('no-anim'); }, 50);
            }
            highlightVisibleSection();
        };

        const highlightVisibleSection = () => {
            let currentSectionId = "";
            sections.forEach(section => {
                if (window.scrollY >= (section.offsetTop - 200)) {
                    currentSectionId = section.getAttribute('id');
                }
            });

            let activeItem = null;
            relatedItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === currentSectionId) {
                    item.classList.add('active');
                    activeItem = item;
                }
            });

            if (activeItem && currentMenuState === 'horizontal' && !floatingComponentContainer.classList.contains('static-mode')) {
                const containerWidth = relatedItemsWrapper.offsetWidth;
                const itemLeft = activeItem.offsetLeft;
                const itemWidth = activeItem.offsetWidth;
                const scrollPosition = itemLeft - (containerWidth / 2) + (itemWidth / 2);
                relatedItemsWrapper.scrollTo({ left: scrollPosition, behavior: 'smooth' });
            }
        };

        relatedItems.forEach(item => {
            item.addEventListener('click', () => {
                if (currentMenuState === 'vertical') {
                    floatingComponentContainer.classList.add('no-anim');
                    currentMenuState = 'horizontal'; saveState(); updateMenuVisuals();
                    setTimeout(() => floatingComponentContainer.classList.remove('no-anim'), 50);
                }
                const targetId = item.dataset.section;
                const el = document.getElementById(targetId);
                if(el) {
                    const headerOffset = 100; 
                    const elementPosition = el.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                    window.scrollTo({ top: offsetPosition, behavior: "smooth" });
                }
            });
        });

        window.addEventListener('scroll', handleScrollBehavior);
        window.addEventListener('load', () => {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) currentMenuState = saved;
            handleScrollBehavior();
        });

    </script>
</body>
</html>

